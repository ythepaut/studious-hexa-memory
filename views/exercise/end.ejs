<%- include('../includes/header') %>

<div class="box">
    <h1 class="title has-text-centered">Fin de l'entraînement !</h1>
    <h2 class="subtitle has-text-centered">
        <% if (practice.endReason === "MANUAL") { %>
            Vous avez arrêté les exercices
        <% } else if (practice.endReason === "MAX_REACHED") { %>
            Objectif d'exercices atteint
        <% } else if (practice.endReason === "DEPLETED") { %>
            Vous avez fait tous les exercices des tags sélectionnés
        <% } %>
    </h2>

    <hr />

    <div class="mt-3 has-text-centered">
        <span class="is-size-4">Statistiques</span>
    </div>

    <div class="columns is-align-items-center is-justify-content-center mt-3">


        <div class="columm is-parent is-vertical md-6">

            <article class="tile is-child notification is-light mt-3">
                <h3>Nombre d'exercices effectués</h3>
                <span class="is-size-3"><%= practice.exercisesDone.length %></span>
            </article>
            <br />
            <article class="tile is-child notification is-light mt-3">
                <h3>Pourcentage de réussite</h3>
                <span class="is-size-3">
                    <% if (practice.exercisesDone.length) { %>
                        <%= Math.trunc(practice.exerciseSuccessCount / practice.exercisesDone.length * 100) %>%
                    <% } else { %>
                        0%
                    <% } %>
                </span>
            </article>

        </div>


        <div class="column is-one-quarter ml-6">
            <img src="/assets/img/end.png" alt="" />
        </div>

    </div>

    <hr />

    <div class="mt-3 has-text-centered">
        <span class="is-size-4">Résumé</span>

        <table class="table is-striped is-fullwidth has-text-left mt-4">
            <thead>
            <tr>
                <th style="width:5%;"><abbr title="Passer la souris sur les numéros pour voir les ID n'exercice">N°</abbr></th>
                <th style="width:50%;">Titre</th>
                <th style="width:30%;">Tags</th>
                <th>Réussi</th>
            </tr>
            </thead>
            <tbody>
                <%
                var i = 0;
                for (const exercise of practice.exercisesDone) {
                i += 1;
                %>
                <tr>
                    <th><span title="<%= exercise.id %>"><%= i %></span></th>
                    <td><%= exercise.title %></td>
                    <td>
                        <% for (const tag of exercise.tags) { %>
                            <span class="tag is-primary is-small"><%= tag.toUpperCase() %></span>
                        <% } %>
                    </td>
                    <td>
                        <% if (exercise.success) { %>
                            <span class="tag is-success">Oui</span>
                        <% } else { %>
                            <span class="tag is-danger">Non</span>
                        <% } %>
                    </td>
                </tr>
                <% } %>
            </tbody>
        </table>
    </div>

    <hr />

    <div class="mt-3 has-text-centered">
        <form method="POST" action="/">
            <input class="button is-warning is-small mt-3" type="submit" name="finish" value="Terminer" />
        </form>
    </div>
</div>

<script>
    // Render LateX from table
    document.querySelectorAll("td:nth-child(2)").forEach((element) => {
        element.innerHTML = formatLatexImage(element.innerHTML.replaceAll("\n", " "));
    });
</script>

<%- include('../includes/footer') %>
